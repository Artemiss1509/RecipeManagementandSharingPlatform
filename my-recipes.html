<!DOCTYPE html>
<html>
<head>
    <title>My Recipes</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>My Recipes</h1>
    <button onclick="window.location.href='recipes.html'">Browse All</button>
    <button onclick="window.location.href='create-recipe.html'">Create New</button>
    <button onclick="logout()">Logout</button>

    <div id="my-recipes"></div>

    <script>
        const API_URL = 'http://localhost:3000/api';

        function getToken() {
            return localStorage.getItem('token');
        }

        function logout() {
            localStorage.clear();
            window.location.href = 'login.html';
        }

        async function loadMyRecipes() {
            try {
                const profileRes = await axios.get(`${API_URL}/profile/me/profile`, {
                    headers: { Authorization: `Bearer ${getToken()}` }
                });
                const userId = profileRes.data.user.id;

                const response = await axios.get(`${API_URL}/recipes/user/${userId}`);
                const container = document.getElementById('my-recipes');
                container.innerHTML = '';

                response.data.recipes.forEach(recipe => {
                    const div = document.createElement('div');
                    div.style.border = '1px solid #ccc';
                    div.style.padding = '10px';
                    div.style.margin = '10px 0';
                    div.innerHTML = `
                        <h3>${recipe.title}</h3>
                        <p>${recipe.description}</p>
                        <p>Rating: ${recipe.averageRating || 'No ratings'}</p>
                        <button onclick="viewRecipe(${recipe.id})">View</button>
                        <button onclick="deleteRecipe(${recipe.id})">Delete</button>
                        <button onclick="window.location.href='edit-recipe.html?id=${recipe.id}'">Edit</button>
                    `;
                    container.appendChild(div);
                });
            } catch (error) {
                alert('Error: ' + error.response?.data?.message);
            }
        }

        function viewRecipe(id) {
            window.location.href = `recipe-detail.html?id=${id}`;
        }

        async function deleteRecipe(id) {
            if (confirm('Are you sure you want to delete this recipe?')) {
                try {
                    await axios.delete(`${API_URL}/recipes/${id}`, {
                        headers: { Authorization: `Bearer ${getToken()}` }
                    });
                    alert('Recipe deleted!');
                    loadMyRecipes();
                } catch (error) {
                    alert('Error: ' + error.response?.data?.message);
                }
            }
        }

        loadMyRecipes();
    </script>
</body>
</html>
